const apiHost=window.location.hostname,apiPort=window.location.port,host=`http://${apiHost}:${apiPort}/api/console/v1/`,pageHost=`http://${apiHost}:${apiPort}/`;$(document).ready((function(){getProfile(),getQueryParamValue("filter[trashed]")&&$("#filterTrashed").val(getQueryParamValue("filter[trashed]"))}));var Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3});const Swal2=Swal.mixin({customClass:{input:"form-control"}});function getProfile(){var e={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"profile",type:"GET",dataType:"json",headers:e,success:function(e){"admin"===e.user.user_role.id&&$("#addMenuCategoryBtn").show(),"admin"===e.user.user_role.id&&$("#delete").show(),$("#profileName").html(e.user.name),$("#profileRole").html(e.user.user_role.name)},error:function(e,a,t){console.error(JSON.parse(e.responseText).message),window.location.href=pageHost+"login?from-path="+encodeURIComponent(window.location.pathname)}})}function addMenuCategory(e){event.preventDefault();var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"menu-category",type:"POST",data:$("#"+e.id).serializeArray(),headers:a,success:function(a){clearInputErrors(),$("#primary").modal("hide"),clearForm(e.id),Toast.fire({icon:"success",title:"Data berhasil ditambahkan",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){clearInputErrors(),e.responseJSON&&$.each(e.responseJSON.errors,(function(e,a){var t=$('[name="'+e+'"]');t.addClass("is-invalid"),t.after('<div class="invalid-feedback">'+a+"</div>")})),console.error(JSON.parse(e.responseText).message)}})}let trashedFilter=getQueryParamValue("filter[trashed]")?getQueryParamValue("filter[trashed]"):"";$("#filterTrashed").on("change",(function(){trashedFilter=$(this).val(),addOrUpdateQueryParam("filter[trashed]",trashedFilter),customized_datatable.ajax.reload()}));let customized_datatable=$("#menuCategoryTable").DataTable({columns:[{data:null,render:function(e,a,t,r){return r.row+r.settings._iDisplayStart+1}},{data:"name"},{data:null,render:function(e,a,t){return t.menu_count+" Menu"}},{data:null,render:function(e,a,t){return dateIndFormat(t.updated_at)}},{data:null,width:"28%",render:function(e,a,t){let r='<button onclick="getMenuCategory(this)" data-uuid="'+t.uuid+'" class="btn btn-secondary d-flex justify-content-center align-items-center"> <span class="me-2"><i class="bi bi-pencil-square"></i></i></span>Ubah</button>',o='<button onclick="restoreMenuCategory(this)" data-uuid="'+t.uuid+'" class="btn btn-danger d-flex justify-content-center align-items-center"> <span class="me-2"><i class="bi bi-unlock"></i></i></span>Restore</button>';return'<div class="d-flex gap-2">'+("admin"===metaValue.logined_role?"active"===t.status?r:o:"")+"</div>"}}],ajax:{url:host+"menu-category",headers:{Authorization:"Bearer "+localStorage.getItem("bearer")},data:function(e){return{q:e.search.value,filter:{trashed:trashedFilter},page:e.start/e.length+1,limit:e.length}},dataFilter:function(e){var a=jQuery.parseJSON(e);return a.recordsTotal=a.meta.total,a.recordsFiltered=a.meta.total,metaValue=a.meta,a.data=a.data,JSON.stringify(a)},error:function(e,a,t){console.error("Error fetching data:",t)},cache:!0},paging:!0,pageLength:10,lengthMenu:[5,10,25,50,100],responsive:!0,autoWidth:!1,lengthChange:!0,ordering:!1,processing:!0,serverSide:!0,language:dataTablesIdLang});function getMenuCategory(e){var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"menu-category/"+e.dataset.uuid,type:"GET",data:{},headers:a,success:function(e){$("#uuidEdit").val(e.data.uuid),$("#nameEdit").val(e.data.name),$("#delete").attr("data-uuid",e.data.uuid),$("#secondaryEdit").modal("show")},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}function editMenuCategory(e){event.preventDefault();var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"menu-category/"+$("#"+e.id).serializeArray()[0].value,type:"PUT",data:$("#"+e.id).serializeArray(),headers:a,success:function(a){$("#secondaryEdit").modal("hide"),clearInputErrors(),clearForm(e.id),Toast.fire({icon:"success",title:"Data berhasil diubah",timer:1500});let t=customized_datatable.page();customized_datatable.ajax.reload((function(){customized_datatable.page(t).draw(!1)}))},error:function(e,a,t){clearInputErrors(),e.responseJSON&&$.each(e.responseJSON.errors,(function(e,a){var t=$('[name="'+e+'"]');t.addClass("is-invalid"),t.after('<div class="invalid-feedback">'+a+"</div>")})),console.error(JSON.parse(e.responseText).message)}})}function deleteMenuCategory(e){Swal2.fire({icon:"question",title:"Apakah anda yakin?",text:"Apakah anda yakin menghapus kategori menu ini?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",reverseButtons:!1}).then((a=>{if(a.isConfirmed){var t={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"menu-category/"+e.dataset.uuid,type:"DELETE",headers:t,success:function(e){$("#secondaryEdit").modal("hide"),clearInputErrors(),clearForm("editMenuCategoryForm"),Toast.fire({icon:"success",title:"Kategori menu berhasil terhapus",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){Toast.fire({icon:"error",title:JSON.parse(e.responseText).message,timer:1500}),console.error(JSON.parse(e.responseText).message)}})}else a.dismiss===Swal.DismissReason.cancel&&console.log("Operation cancelled")}))}function restoreMenuCategory(e){Swal2.fire({icon:"question",title:"Apakah anda yakin?",text:"Apakah anda yakin mengembalikan kategori menu ini?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",reverseButtons:!1}).then((a=>{if(a.isConfirmed){var t={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"menu-category/"+e.dataset.uuid+"/restore",type:"GET",headers:t,success:function(e){Toast.fire({icon:"success",title:"Kategori menu berhasil dikembalikan",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}else a.dismiss===Swal.DismissReason.cancel&&console.log("Operation cancelled")}))}const setTableColor=()=>{document.querySelectorAll(".dataTables_paginate .pagination").forEach((e=>{e.classList.add("pagination-primary")}))};document.querySelectorAll(".dataTables_paginate .pagination").forEach((e=>{e.classList.add("pagination-primary")}));
