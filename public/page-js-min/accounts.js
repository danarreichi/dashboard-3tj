const apiHost=window.location.hostname,apiPort=window.location.port,host=`http://${apiHost}:${apiPort}/api/console/v1/`,pageHost=`http://${apiHost}:${apiPort}/`;let flatPickr,accountHistoryTable,startBetween=null;$(document).ready((function(){getProfile(),getQueryParamValue("filter[trashed]")&&$("#filterTrashed").val(getQueryParamValue("filter[trashed]")),getRoleDropdown("role"),getRoleDropdown("roleEdit"),flatPickr=flatpickr(".flatpickr-range",{altInput:!0,altFormat:"F j, Y",dateFormat:"Y-m-d",mode:"range",locale:"id"})}));var Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3});const Swal2=Swal.mixin({customClass:{input:"form-control"}});function getProfile(){var e={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"profile",type:"GET",dataType:"json",headers:e,success:function(e){"admin"===e.user.user_role.id&&$("#addAccountBtn").show(),"admin"===e.user.user_role.id&&$("#delete").show(),$("#profileName").html(e.user.name),$("#profileRole").html(e.user.user_role.name)},error:function(e,a,t){console.error(JSON.parse(e.responseText).message),window.location.href=pageHost+"login?from-path="+encodeURIComponent(window.location.pathname)}})}function addAccount(e){event.preventDefault();var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"account",type:"POST",data:$("#"+e.id).serializeArray(),headers:a,success:function(a){clearInputErrors(),$("#primary").modal("hide"),clearForm(e.id),Toast.fire({icon:"success",title:"Data berhasil ditambahkan",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){clearInputErrors(),e.responseJSON&&$.each(e.responseJSON.errors,(function(e,a){var t=$('[name="'+e+'"]');t.addClass("is-invalid"),t.after('<div class="invalid-feedback">'+a+"</div>")})),console.error(JSON.parse(e.responseText).message)}})}function getRoleDropdown(e){var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"dropdown/role",type:"GET",headers:a,success:function(a){var t=$("#"+e);t.empty(),t.append('<option value="" style="display: none;" disabled selected>Pilih peran yang diinginkan</option>'),a.data.forEach((function(e,a){t.append('<option value="'+e.id+'">'+e.name+"</option>")}))},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}let trashedFilter=getQueryParamValue("filter[trashed]")?getQueryParamValue("filter[trashed]"):"";$("#filterTrashed").on("change",(function(){trashedFilter=$(this).val(),addOrUpdateQueryParam("filter[trashed]",trashedFilter),customized_datatable.ajax.reload()}));let customized_datatable=$("#accountTable").DataTable({columns:[{data:null,render:function(e,a,t,r){return r.row+r.settings._iDisplayStart+1}},{data:"name"},{data:"role"},{data:null,render:function(e,a,t){return'<span class="badge bg-'+("active"===t.status?"success":"danger")+'">'+("active"===t.status?"aktif":"non-aktif")+"</span>"}},{data:null,render:function(e,a,t){return dateIndFormat(t.updated_at)}},{data:null,width:"28%",render:function(e,a,t){var r='<button onclick="getAccount(this)" data-uuid="'+t.uuid+'" class="btn btn-secondary d-flex justify-content-center align-items-center"> <span class="me-2"><i class="bi bi-pencil-square"></i></i></span>Ubah</button>',n='<button onclick="getAccountHistory(this)" data-uuid="'+t.uuid+'" class="btn btn-info d-flex justify-content-center align-items-center"> <span class="me-2"><i class="bi bi-clock-history"></i></i></span>Riwayat</button>',o='<button onclick="restoreAccount(this)" data-uuid="'+t.uuid+'" class="btn btn-danger d-flex justify-content-center align-items-center"> <span class="me-2"><i class="bi bi-unlock"></i></i></span>Restore</button>';return'<div class="d-flex gap-2">'+("active"===t.status?r+n:o)+"</div>"}}],ajax:{url:host+"account",headers:{Authorization:"Bearer "+localStorage.getItem("bearer")},data:function(e){return{q:e.search.value,filter:{trashed:trashedFilter},page:e.start/e.length+1,limit:e.length}},dataFilter:function(e){var a=jQuery.parseJSON(e);return a.recordsTotal=a.meta.total,a.recordsFiltered=a.meta.total,metaValue=a.meta,a.data=a.data,JSON.stringify(a)},error:function(e,a,t){console.error("Error fetching data:",t)},cache:!0},paging:!0,pageLength:10,lengthMenu:[5,10,25,50,100],responsive:!0,autoWidth:!1,lengthChange:!0,ordering:!1,processing:!0,serverSide:!0,language:dataTablesIdLang});function getAccountHistory(e){$.fn.DataTable.isDataTable("#accountHistoryTable")&&($("#accountHistoryTable").DataTable().clear().destroy(),startBetween=null,flatPickr.clear(),$("#dateRange").val(null),$("#modalUsername").html(null)),getModalAccountName(e),accountHistoryTable=$("#accountHistoryTable").DataTable({columns:[{data:null,render:function(e,a,t,r){return r.row+r.settings._iDisplayStart+1}},{data:"name"},{data:null,render:function(e,a,t){return`<span class="badge ${"in"===t.status?"bg-success":"bg-danger"}">${"in"===t.status?"masuk":"keluar"}</span>`}},{data:"qty"},{data:"new_qty"},{data:"price"},{data:null,render:function(e,a,t){return dateIndFormat(t.created_at)}}],ajax:{url:host+"account/"+e.dataset.uuid+"/history",headers:{Authorization:"Bearer "+localStorage.getItem("bearer")},data:function(e){let a={start_between:startBetween};return a.start_between||(a={}),{q:e.search.value,filter:a,page:e.start/e.length+1,limit:e.length}},dataFilter:function(e){var a=jQuery.parseJSON(e);if(a.recordsTotal=a.meta.total,a.recordsFiltered=a.meta.total,a.meta.date_min&&a.meta.date_max){let e=a.meta.date_min.split(" ")[0],t=a.meta.date_max.split(" ")[0];flatPickr.set("minDate",e),flatPickr.set("maxDate",t)}return $("#infoHistory").modal("show"),metaValue=a.meta,a.data=a.data,JSON.stringify(a)},error:function(e,a,t){console.error("Error fetching data:",t)},cache:!0},paging:!0,pageLength:5,lengthMenu:[5,10,25,50,100],responsive:!0,autoWidth:!1,lengthChange:!0,ordering:!1,processing:!0,serverSide:!0,language:dataTablesIdLang})}function getDatepickr(e){let a=e._flatpickr.selectedDates;2===a.length&&(startBetween=`${a[0].toLocaleDateString("sv-SE")},${a[1].toLocaleDateString("sv-SE")}`,accountHistoryTable.ajax.reload())}function getModalAccountName(e){var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"account/"+e.dataset.uuid,type:"GET",data:{},headers:a,success:function(e){$("#modalUsername").html(e.data.name)},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}function getAccount(e){var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"account/"+e.dataset.uuid,type:"GET",data:{},headers:a,success:function(e){clearInputErrors(),$("#uuidEdit").val(e.data.uuid),$("#nameEdit").val(e.data.name),$("#usernameEdit").val(e.data.username),$("#roleEdit").val(e.data.role_id),$("#statusEdit").val(e.data.status),$("#delete").attr("data-uuid",e.data.uuid),$("#secondaryEdit").modal("show")},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}function editAccount(e){event.preventDefault();var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"account/"+$("#"+e.id).serializeArray()[0].value,type:"PUT",data:$("#"+e.id).serializeArray(),headers:a,success:function(a){$("#secondaryEdit").modal("hide"),clearInputErrors(),clearForm(e.id),Toast.fire({icon:"success",title:"Data edited",timer:1500}),getProfile(),customized_datatable.ajax.reload()},error:function(e,a,t){clearInputErrors(),e.responseJSON&&$.each(e.responseJSON.errors,(function(e,a){var t=$('[name="'+e+'"]');t.addClass("is-invalid"),t.after('<div class="invalid-feedback">'+a+"</div>")})),console.error(JSON.parse(e.responseText).message)}})}function deleteAccount(e){Swal2.fire({icon:"question",title:"Apakah anda yakin?",text:"Apakah anda ingin untuk membatasi account ini?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",reverseButtons:!1}).then((a=>{if(a.isConfirmed){var t={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"account/"+e.dataset.uuid,type:"DELETE",headers:t,success:function(e){$("#secondaryEdit").modal("hide"),clearInputErrors(),clearForm("editAccountForm"),Toast.fire({icon:"success",title:"Account berhasil terbanned",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){Toast.fire({icon:"error",title:JSON.parse(e.responseText).message,timer:1500}),console.error(JSON.parse(e.responseText).message)}})}else a.dismiss===Swal.DismissReason.cancel&&console.log("Operation cancelled")}))}function restoreAccount(e){Swal2.fire({icon:"question",title:"Apakah anda yakin?",text:"Apakah anda ingin untuk mengembalikan account ini?",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",reverseButtons:!1}).then((a=>{if(a.isConfirmed){var t={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"account/"+e.dataset.uuid+"/restore",type:"GET",headers:t,success:function(e){Toast.fire({icon:"success",title:"Account berhasil dikembalikan",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}else a.dismiss===Swal.DismissReason.cancel&&console.log("Operation cancelled")}))}const setTableColor=()=>{document.querySelectorAll(".dataTables_paginate .pagination").forEach((e=>{e.classList.add("pagination-primary")}))};document.querySelectorAll(".dataTables_paginate .pagination").forEach((e=>{e.classList.add("pagination-primary")}));
