const apiHost=window.location.hostname,apiPort=window.location.port,host=`http://${apiHost}:${apiPort}/api/console/v1/`,pageHost=`http://${apiHost}:${apiPort}/`;let inventoryHistoryTable,startBetween=null;function toggleButtonClass(e){$(e).hasClass("collapsed")?$(e).removeClass("btn-outline-primary").addClass("btn-primary"):$(e).removeClass("btn-primary").addClass("btn-outline-primary")}$(document).ready((function(){getProfile(),getQueryParamValue("filter[trashed]")&&$("#filterTrashed").val(getQueryParamValue("filter[trashed]"))}));var Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}),flatPickr=flatpickr(".flatpickr-range",{altInput:!0,altFormat:"F j, Y",dateFormat:"Y-m-d",mode:"range",locale:"id"});const Swal2=Swal.mixin({customClass:{input:"form-control"}});function getProfile(){var e={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"profile",type:"GET",dataType:"json",headers:e,success:function(e){"admin"===e.user.user_role.id&&$("#addInventoryBtn").show(),"admin"===e.user.user_role.id&&$("#delete").show(),$("#profileName").html(e.user.name),$("#profileRole").html(e.user.user_role.name)},error:function(e,a,t){console.error(JSON.parse(e.responseText).message),window.location.href=pageHost+"login?from-path="+encodeURIComponent(window.location.pathname)}})}function addInventory(e){event.preventDefault();var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"inventory",type:"POST",data:$("#"+e.id).serializeArray(),headers:a,success:function(a){clearInputErrors(),$("#primary").modal("hide"),clearForm(e.id),Toast.fire({icon:"success",title:"Data berhasil ditambahkan",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){clearInputErrors(),e.responseJSON&&$.each(e.responseJSON.errors,(function(e,a){var t=$('[name="'+e+'"]');t.addClass("is-invalid"),t.after('<div class="invalid-feedback">'+a+"</div>")})),console.error(JSON.parse(e.responseText).message)}})}let trashedFilter=getQueryParamValue("filter[trashed]")?getQueryParamValue("filter[trashed]"):"";$("#filterTrashed").on("change",(function(){trashedFilter=$(this).val(),addOrUpdateQueryParam("filter[trashed]",trashedFilter),customized_datatable.ajax.reload()}));let customized_datatable=$("#inventoryTable").DataTable({columns:[{data:null,render:function(e,a,t,r){return r.row+r.settings._iDisplayStart+1}},{data:"name"},{data:"qty"},{data:"unit"},{data:null,render:function(e,a,t){return dateIndFormat(t.updated_at)}},{data:null,width:"28%",render:function(e,a,t){var r='<button onclick="getInventory(this)" data-uuid="'+t.uuid+'" class="btn btn-secondary d-flex justify-content-center align-items-center"> <span class="me-2"><i class="bi bi-pencil-square"></i></i></span>Ubah</button>',n='<button onclick="getInventoryHistory(this)" data-uuid="'+t.uuid+'" class="btn btn-info d-flex justify-content-center align-items-center"> <span class="me-2"><i class="bi bi-clock-history"></i></i></span>Riwayat</button>',o='<button onclick="restoreInventory(this)" data-uuid="'+t.uuid+'" class="btn btn-danger d-flex justify-content-center align-items-center"> <span class="me-2"><i class="bi bi-unlock"></i></i></span>Restore</button>';return'<div class="d-flex gap-2">'+("admin"===metaValue.logined_role?"active"===t.status?r+n:o:"active"===t.status?n:"")+"</div>"}}],ajax:{url:host+"inventory",headers:{Authorization:"Bearer "+localStorage.getItem("bearer")},data:function(e){return{q:e.search.value,filter:{trashed:trashedFilter},page:e.start/e.length+1,limit:e.length}},dataFilter:function(e){var a=jQuery.parseJSON(e);return a.recordsTotal=a.meta.total,a.recordsFiltered=a.meta.total,metaValue=a.meta,a.data=a.data,JSON.stringify(a)},error:function(e,a,t){console.error("Error fetching data:",t)},cache:!0},paging:!0,pageLength:10,lengthMenu:[5,10,25,50,100],responsive:!0,autoWidth:!1,lengthChange:!0,ordering:!1,processing:!0,serverSide:!0,language:dataTablesIdLang});function getInventoryHistory(e){$.fn.DataTable.isDataTable("#inventoryHistoryTable")&&($("#inventoryHistoryTable").DataTable().clear().destroy(),startBetween=null,flatPickr.clear(),flatPickr.set("minDate",null),flatPickr.set("maxDate",null),$("#dateRange").val(null),$("#modalInventoryName").html(null),$("#modalInventoryQty").html(null)),clearInputErrors(),clearForm("adjustStockForm"),getModalInventoryName(e),inventoryHistoryTable=$("#inventoryHistoryTable").DataTable({columns:[{data:null,render:function(e,a,t,r){return r.row+r.settings._iDisplayStart+1}},{data:"name"},{data:null,render:function(e,a,t){return`<span class="badge ${"in"===t.status?"bg-success":"bg-danger"}">${"in"===t.status?"masuk":"keluar"}</span>`}},{data:"qty"},{data:"new_qty"},{data:"price"},{data:null,render:function(e,a,t){return dateIndFormat(t.created_at)}}],ajax:{url:host+"inventory/"+e.dataset.uuid+"/history",headers:{Authorization:"Bearer "+localStorage.getItem("bearer")},data:function(e){let a={start_between:startBetween};return a.start_between||(a={}),{q:e.search.value,filter:a,page:e.start/e.length+1,limit:e.length}},dataFilter:function(e){var a=jQuery.parseJSON(e);if(a.recordsTotal=a.meta.total,a.recordsFiltered=a.meta.total,a.meta.date_min&&a.meta.date_max){let e=a.meta.date_min.split(" ")[0],t=a.meta.date_max.split(" ")[0];flatPickr.set("minDate",e),flatPickr.set("maxDate",t)}return $("#infoHistory").modal("show"),metaValue=a.meta,a.data=a.data,JSON.stringify(a)},error:function(e,a,t){console.error("Error fetching data:",t)},cache:!0},paging:!0,pageLength:5,lengthMenu:[5,10,25,50,100],responsive:!0,autoWidth:!1,lengthChange:!0,ordering:!1,processing:!0,serverSide:!0,language:dataTablesIdLang})}function getDatepickr(e){let a=e._flatpickr.selectedDates;2===a.length&&(startBetween=`${a[0].toLocaleDateString("sv-SE")},${a[1].toLocaleDateString("sv-SE")}`,inventoryHistoryTable.ajax.reload())}function getModalInventoryName(e){var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"inventory/"+e.dataset.uuid,type:"GET",data:{},headers:a,success:function(e){$("#uuidAdjust").val(e.data.uuid),$("#modalInventoryName").html(e.data.name),$("#modalInventoryQty").html(`${e.data.qty} ${e.data.unit}`)},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}function getInventory(e){var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"inventory/"+e.dataset.uuid,type:"GET",data:{},headers:a,success:function(e){$("#uuidEdit").val(e.data.uuid),$("#nameEdit").val(e.data.name),$("#unitEdit").val(e.data.unit),$("#qtyEdit").val(e.data.qty),$("#delete").attr("data-uuid",e.data.uuid),$("#secondaryEdit").modal("show")},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}function editInventory(e){event.preventDefault();var a={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"inventory/"+$("#"+e.id).serializeArray()[0].value,type:"PUT",data:$("#"+e.id).serializeArray(),headers:a,success:function(a){$("#secondaryEdit").modal("hide"),clearInputErrors(),clearForm(e.id),Toast.fire({icon:"success",title:"Data berhasil diubah",timer:1500});let t=customized_datatable.page();customized_datatable.ajax.reload((function(){customized_datatable.page(t).draw(!1)}))},error:function(e,a,t){clearInputErrors(),e.responseJSON&&$.each(e.responseJSON.errors,(function(e,a){var t=$('[name="'+e+'"]');t.addClass("is-invalid"),t.after('<div class="invalid-feedback">'+a+"</div>")})),console.error(JSON.parse(e.responseText).message)}})}function deleteInventory(e){Swal2.fire({icon:"question",title:"Apakah anda yakin?",text:"Apakah anda yakin menghapus inventory ini?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",reverseButtons:!1}).then((a=>{if(a.isConfirmed){var t={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"inventory/"+e.dataset.uuid,type:"DELETE",headers:t,success:function(e){$("#secondaryEdit").modal("hide"),clearInputErrors(),clearForm("editInventoryForm"),Toast.fire({icon:"success",title:"Inventory berhasil terhapus",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){Toast.fire({icon:"error",title:JSON.parse(e.responseText).message,timer:1500}),console.error(JSON.parse(e.responseText).message)}})}else a.dismiss===Swal.DismissReason.cancel&&console.log("Operation cancelled")}))}function restoreInventory(e){Swal2.fire({icon:"question",title:"Apakah anda yakin?",text:"Apakah anda yakin mengembalikan inventory ini?",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",reverseButtons:!1}).then((a=>{if(a.isConfirmed){var t={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+"inventory/"+e.dataset.uuid+"/restore",type:"GET",headers:t,success:function(e){Toast.fire({icon:"success",title:"Inventory berhasil dikembalikan",timer:1500}),customized_datatable.ajax.reload()},error:function(e,a,t){console.error(JSON.parse(e.responseText).message)}})}else a.dismiss===Swal.DismissReason.cancel&&console.log("Operation cancelled")}))}function adjustStock(e){event.preventDefault();let a=$(e).serializeArray();Swal2.fire({icon:"question",title:"Apakah anda yakin?",text:`Apakah anda ingin ${"in"===a[1].value?`memasukkan ${a[2].value} item ke`:`mengurangi ${a[2].value} item dari`} inventory?`,showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",inputAutoFocus:!1,didOpen:()=>{flatPickr.destroy()},didClose:()=>{flatPickr=flatpickr(".flatpickr-range",{altInput:!0,altFormat:"F j, Y",dateFormat:"Y-m-d",mode:"range",locale:"id"})},reverseButtons:!1}).then((t=>{if(t.isConfirmed){let t=a[0].value;var r={Authorization:"Bearer "+localStorage.getItem("bearer")};$.ajax({url:host+`inventory/${t}/adjust`,type:"POST",data:a,headers:r,success:function(a){clearInputErrors(),clearForm(e.id),Toast.fire({icon:"success",title:"Data berhasil diatur",timer:1500}),getModalInventoryName({dataset:{uuid:t}}),inventoryHistoryTable.ajax.reload();let r=customized_datatable.page();customized_datatable.ajax.reload((function(){customized_datatable.page(r).draw(!1)}))},error:function(e,a,r){clearInputErrors(),e.responseJSON&&($.each(e.responseJSON.errors,(function(e,a){var t=$('[name="'+e+'"]');t.addClass("is-invalid"),t.after('<div class="invalid-feedback">'+a+"</div>")})),getModalInventoryName({dataset:{uuid:t}}),inventoryHistoryTable.ajax.reload()),console.error(JSON.parse(e.responseText).message)}})}else t.dismiss===Swal.DismissReason.cancel&&console.log("Operation cancelled")}))}const setTableColor=()=>{document.querySelectorAll(".dataTables_paginate .pagination").forEach((e=>{e.classList.add("pagination-primary")}))};document.querySelectorAll(".dataTables_paginate .pagination").forEach((e=>{e.classList.add("pagination-primary")}));
